@using BlazorAgenda.Shared.Enums;
@using BlazorAgenda.Shared.Models;
@using BlazorAgenda.Shared.Interfaces;
@using BlazorAgenda.Shared.Interfaces.BaseObjects;
@using BlazorAgenda.Services.Interfaces;

@switch ((ElementTypes)Option.ElementType)
{
    case ElementTypes.Text:
        if (Option.IsMandatory)
        {
            <input class="textInput" type="text" bind="@EventOption.Value" placeholder="@Option.Description" required />
        }
        else
        {
            <input class="textInput" type="text" bind="@EventOption.Value" placeholder="@Option.Description"/>
        }
        break;
    case ElementTypes.Check:
        if (Option.IsMandatory)
        {
            <label class="Ccontainer">
                <input class="form-control checkbox" type="checkbox" bind="@CheckBoxValue" required />
                <span class="Ccheckmark"></span>
            </label>

        }
        else
        {
            <label class="container">
                <input class="form-control checkbox" type="checkbox" bind="@CheckBoxValue" />
                <span class="checkmark"></span>
            </label>
        }
        break;
    case ElementTypes.Number:
        if (Option.IsMandatory)
        {
            <input class="textInput" type="number" step="1" bind="@EventOption.Value" placeholder=0 required />
        }
        else
        {
            <input class="textInput" type="number" step="1" bind="@EventOption.Value" placeholder=0 />
        }
        break;
    case ElementTypes.Telephonenumber:
        if (Option.IsMandatory)
        {
            <input class="textInput" type="tel" pattern="[0-9]{8}" bind="@EventOption.Value" required />
        }
        else
        {
            <input class="textInput" type="tel" pattern="[0-9]{8}" bind="@EventOption.Value" />
        }
        break;
    case ElementTypes.Address:
        if (Option.IsMandatory)
        {
            <input class="textInput" type="text" pattern="^\d{4}\D{2}$" bind="@EventOption.Value" required />
        }
        else
        {
            <input class="textInput" type="text" pattern="^\d{4}\D{2}$" bind="@EventOption.Value" />
        }
        break;
    case ElementTypes.Date:
        if (Option.IsMandatory)
        {
            <input class="textInput" type="date" bind="@EventOption.Value" required />
        }
        else
        {
            <input class="textInput" type="date" bind="@EventOption.Value" />
        }
        break;
    case ElementTypes.Email:
        if (Option.IsMandatory)
        {
            <input class="textInput" type="email" bind="@EventOption.Value" />
        }
        else
        {
            <input class="textInput" type="email" bind="@EventOption.Value" />
        }
        break;

    case ElementTypes.Textarea:
        if (Option.IsMandatory)
        {
            <textarea class="form-control" bind="@EventOption.Value" />
        }
        else
        {
            <textarea class="form-control" bind="@EventOption.Value" />
        }
        break;
    case ElementTypes.StaffSelection:
        if (Option.IsMandatory)
        {
            <select bind="@EventOption.Value" required>
                <option value="" selected disabled hidden>-- Choose a staffmember --</option>
                @foreach (User dropdownItem in StaffMembers)
                {
                    <option value="@dropdownItem.Emailadress">@dropdownItem.Firstname @dropdownItem.Lastname</option>
                }
            </select>
        }
        else
        {
            <select bind="@EventOption.Value">
                <option value="" selected>-- Choose a staffmember --</option>
                @foreach (User dropdownItem in StaffMembers)
                {
                    <option value="@dropdownItem.Emailadress">@dropdownItem.Firstname @dropdownItem.Lastname</option>
                }
            </select>
        }

        break;
    case ElementTypes.Dropdown:
        if (Option.IsMandatory)
        {
            <select onchange="@OnDropdownChange" required>
                @if (EventOption.Value == null)
                {
                    <option value="" selected disabled hidden>-- Choose an option --</option>
                }
                @foreach (Option dropdownItem in Option.InverseOptionNavigation)
                {
                    if (EventOption.Value == dropdownItem.Text)
                    {
                        <option value="@dropdownItem.Text" selected>@dropdownItem.Text</option>
                    }
                    else
                    {
                        <option value="@dropdownItem.Text">@dropdownItem.Text</option>
                    }
                }
            </select>
        }
        else
        {
            <select onchange="@OnDropdownChange">
                @if (EventOption.Value == null)
                {
                    <option value="" selected>-- Choose an option --</option>
                }
                @foreach (Option dropdownItem in Option.InverseOptionNavigation)
                {
                    if (EventOption.Value == dropdownItem.Text)
                    {
                        <option value="@dropdownItem.Text" selected>@dropdownItem.Text</option>
                    }
                    else
                    {
                        <option value="@dropdownItem.Text">@dropdownItem.Text</option>
                    }
                }
            </select>
        }

        break;
        @*case ElementTypes.MultiSelect:
                    <input class="form-control" type="email" bind="@EventOption.Value" />
                    break;
            case ElementTypes.Radiobutton:
                <input class="form-control" type="checkbox" bind="@EventOption.Value" />
                break;*@
}

@functions
{
    [Parameter] protected IOption Option { get; set; }

    [Parameter] [Inject] protected IEventOption EventOption { get; set; }

    [Inject] protected IUserService UserService { get; set; }
    [Inject] protected IOptionService OptionService { get; set; }
    [Inject] protected IStateService StateService { get; set; }
    [Parameter] public List<User> StaffMembers { get; set; }
    [Parameter] Action<IEventOption> OnNewEventOption { get; set; }
    private bool _checkBoxValue = false;

    public bool CheckBoxValue
    {
        get { return _checkBoxValue; }
        set
        {
            _checkBoxValue = value;
            EventOption.Value = CheckBoxValue.ToString();
        }
    }


    protected override void OnParametersSet()
    {
        EventOption.Option = Option as Option;
        if (EventOption.Value == null)
        {
            OnNewEventOption?.Invoke(EventOption);
        }
        if ((ElementTypes)Option.ElementType == ElementTypes.Check)
        {
            if (EventOption.Value == string.Empty)
            {
                EventOption.Value = "False";
            }
            else if (EventOption.Value == "True")
            {
                CheckBoxValue = true;
            }
        }
    }

    protected async override Task OnParametersSetAsync()
    {
        if (StaffMembers == null && (ElementTypes)Option.ElementType == ElementTypes.StaffSelection)
        {
            StaffMembers = new List<User>();
            StaffMembers = await UserService.GetStaffByOrganization(StateService.Organization);
        }
    }

    public void OnCheckboxChanged(UIChangeEventArgs e)
    {
        EventOption.Value = e.Value.ToString();
    }

    public void OnDropdownChange(UIChangeEventArgs e)
    {
        EventOption.Value = e.Value.ToString();
        EventOption.Option = Option.InverseOptionNavigation.FirstOrDefault(suboption => suboption.Text == e.Value.ToString());
    }
}
