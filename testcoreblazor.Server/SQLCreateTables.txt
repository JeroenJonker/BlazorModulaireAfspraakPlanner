CREATE DATABASE AgendaDB
GO

USE [AgendaDB]
GO

CREATE TABLE [Organization](
	[ID] int NOT NULL IDENTITY(1,1) PRIMARY KEY,
	[NAME] nvarchar(30) NOT NULL UNIQUE,
	[IS_PRIVATE] BIT NOT NULL DEFAULT 0
);
GO

CREATE TABLE [User] (
    [ID] int NOT NULL IDENTITY(1,1) PRIMARY KEY,
    [EMAILADRESS] nvarchar(40) NOT NULL UNIQUE,
    [FIRSTNAME] nvarchar(40),
	[LASTNAME] nvarchar(40),
	[PASSWORD] nvarchar(65) NOT NULL,
    [IS_ADMIN] BIT NOT NULL DEFAULT 0,
	[ORGANIZATION_ID] int NOT NULL,
	CONSTRAINT [FK_Organization_User] FOREIGN KEY ([ORGANIZATION_ID]) REFERENCES [ORGANIZATION] ([ID]) 
);
GO

CREATE TABLE [Event](
	[ID] int NOT NULL IDENTITY(1,1) PRIMARY KEY,
	[SUMMARY] nvarchar(30),
	[START] datetime NOT NULL,
	[END] datetime NOT NULL,
	[LOCATION] nvarchar(30),
	[USER_ID] int NOT NULL,
	[IS_PRIVATE] BIT NOT NULL DEFAULT 0,
	CONSTRAINT [FK_Event_User] FOREIGN KEY ([USER_ID]) REFERENCES [User] ([ID]) ON DELETE CASCADE
);
GO

CREATE TABLE [Option](
	[ID] int NOT NULL IDENTITY(1,1) PRIMARY KEY,
	[TEXT] nvarchar(30) NOT NULL,
	[DESCRIPTION] nvarchar(30),
	[ELEMENT_TYPE] int NOT NULL,
	[POSITION_ORDER] int,
	[TIME_MODIFIER] int not null default 0,
	[ORGANIZATION_ID] int,
	[OPTION_ID] int,
	[IS_MANDATORY] BIT NOT NULL DEFAULT 0,
	CONSTRAINT FK_Organization_Option FOREIGN KEY (ORGANIZATION_ID) REFERENCES [Organization] (ID) ON DELETE CASCADE,
	CONSTRAINT FK_Option_Option FOREIGN KEY (Option_ID) REFERENCES [Option] (ID)
);
GO

CREATE TABLE [EventOption](
	[ID] int NOT NULL IDENTITY(1,1) PRIMARY KEY,
	[EVENT_ID] int NOT NULL,
	[OPTION_ID] int NOT NULL,
	[VALUE] varchar(30),
	CONSTRAINT FK_Option_EventOption FOREIGN KEY (OPTION_ID) REFERENCES [Option] (ID) ON DELETE CASCADE,
	CONSTRAINT FK_Event_EventOption FOREIGN KEY (EVENT_ID) REFERENCES [Event] (ID) ON DELETE CASCADE
);
GO

CREATE TABLE [Job](
	[ID] int NOT NULL IDENTITY(1,1) PRIMARY KEY,
	[NAME] varchar(30),
	[DESCRIPTION] varchar(30),
	[ORGANIZATION_ID] int,
	CONSTRAINT FK_Organization_Job FOREIGN KEY (ORGANIZATION_ID) REFERENCES [Organization] (ID) ON DELETE CASCADE,
);
GO

CREATE TABLE [UserJob](
	[ID] int NOT NULL IDENTITY(1,1) PRIMARY KEY,
	[USER_ID] int NOT NULL,
	[Job_ID] int NOT NULL,
	CONSTRAINT FK_User_UserJob FOREIGN KEY (USER_ID) REFERENCES [User] (ID) ON DELETE CASCADE,
	CONSTRAINT FK_Job_UserJob FOREIGN KEY (JOB_ID) REFERENCES [Job] (ID) ON DELETE CASCADE,
);
GO

CREATE TABLE [Workhours](
	[ID] int NOT NULL IDENTITY(1,1) PRIMARY KEY,
	[START] datetime not null,
	[END] datetime not null,
	[USER_ID] int not null,
	CONSTRAINT FK_User_Workhours FOREIGN KEY ([USER_ID]) REFERENCES [USER] (ID) ON DELETE CASCADE,
);
GO

INSERT INTO [Organization] (NAME, IS_PRIVATE)
VALUES ('Advocaat Jan', 0);
GO

INSERT INTO [User] (EMAILADRESS, FIRSTNAME, LASTNAME, PASSWORD, IS_ADMIN, ORGANIZATION_ID)
VALUES ('a@a.com', 'a', 'a', 'CA978112CA1BBDCAFAC231B39A23DC4DA786EFF8147C4E72B9807785AFEE48BB', 1, 1);
GO

INSERT INTO [Job] (NAME, DESCRIPTION, ORGANIZATION_ID)
VALUES ('Kapper', 'krabt de krullen van de trap', 1);
GO
